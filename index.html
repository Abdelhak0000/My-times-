<!DOCTYPE html>
<html lang="ar">  
<head>  
  <meta charset="UTF-8" />  
  <title>ğŸ“† Ø¬Ø¯ÙˆÙ„ Ø£Ø³Ø¨ÙˆØ¹ÙŠ â€” Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„Ù‚Ø§Ù„Ø©</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  

  <!-- PWA -->  
  <link rel="manifest" href="manifest.json">  
  <meta name="theme-color" content="#11998e">  
  <link rel="icon" href="icon.jpg" type="image/jpeg">  

  <style>  
    body {  
      font-family: "Cairo", Tahoma, sans-serif;  
      background: linear-gradient(135deg,#11998e,#38ef7d);  
      margin: 0;  
      padding: 20px;  
      text-align: center;  
      color: #fff;  
    }  
    h1 {  
      font-size: 2em;  
      margin-bottom: 20px;  
      padding: 10px 20px;  
      display: inline-block;  
      background: rgba(255,255,255,0.15);  
      border-radius: 12px;  
      border: 2px solid rgba(255,255,255,0.4);  
    }  
    table {  
      width: 60%;  
      margin: 20px auto;  
      border-collapse: collapse;  
      background: #fff;  
      box-shadow: 0 8px 25px rgba(0,0,0,0.25);  
      color: #333;  
      border-radius: 15px;  
      overflow: hidden;  
      min-width: 280px;  
      max-width: 600px;  
    }  
    thead {background: #2ecc71; color: white; font-size: 1.2em;}  
    th,td {border:1px solid #ddd; padding:14px; font-size:1.1em; text-align:right;}  
    td input {  
      width: 95%;  
      padding: 10px;  
      border: 1px solid #ccc;  
      border-radius: 6px;  
      font-size: 1em;  
      text-align: right;  
      direction: rtl;  
      box-sizing: border-box;  
    }  
    tr:nth-child(even){background:#f9f9f9;}  
    tr:hover{background:#eafaf1;}  
    #dayTitle {  
      margin-bottom: 15px;  
      font-size: 1.5em;  
      font-weight: bold;  
      color: #fff;  
      text-shadow: 1px 1px 2px #00000055;  
    }  
    @media(max-width:480px){  
      table{width:90%;}  
      h1{font-size:1.5em;}  
    }  

    /* ===== Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø­ØªØ±Ø§ÙÙŠ Ø«Ø§Ø¨Øª (Ø®Ø±ÙˆØ¬ -> ØªØ­Ø¯ÙŠØ« -> Ø¯Ø®ÙˆÙ„) ===== */
    /* Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© - Ø³ÙŠØªÙ… Ø§Ù„ØªØ­ÙƒÙ… Ø¨ÙƒÙ„Ø§Ø³Ø§Øª off-left / off-right / on */
    #scheduleTable.fade-slide {
      transition: transform 420ms cubic-bezier(.22,.9,.3,1), opacity 350ms ease;
      transform: translateX(0);
      opacity: 1;
    }

    /* Ø®Ø±ÙˆØ¬ Ù†Ø­Ùˆ Ø§Ù„ÙŠØ³Ø§Ø± (Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ®ØªÙÙŠ Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±) */
    #scheduleTable.fade-slide.off-left {
      transform: translateX(-40px);
      opacity: 0;
    }

    /* Ø®Ø±ÙˆØ¬ Ù†Ø­Ùˆ Ø§Ù„ÙŠÙ…ÙŠÙ† (Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ®ØªÙÙŠ Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†) */
    #scheduleTable.fade-slide.off-right {
      transform: translateX(40px);
      opacity: 0;
    }

    /* Ø¯Ø®ÙˆÙ„ Ù…Ø±ÙƒØ²ÙŠ (Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„ÙˆØ³Ø· ÙˆÙ…Ø±Ø¦ÙŠ) */
    #scheduleTable.fade-slide.on {
      transform: translateX(0);
      opacity: 1;
    }

  </style>  
</head>  
<body>  
  <h1>ğŸ“† Ø¬Ø¯ÙˆÙ„ Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h1>  
  <div id="dayTitle"></div>  
  <table id="scheduleTable" class="fade-slide on">  
    <thead><tr><th>Ø§Ù„ÙØªØ±Ø©</th><th>Ø§Ù„Ù…Ù‡Ù…Ø©</th></tr></thead>  
    <tbody id="scheduleBody"></tbody>  
  </table>  

  <script>  
    const days=["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];  
    let currentDayIndex=new Date().getDay();  
    const scheduleBody=document.getElementById('scheduleBody');  
    const dayTitle=document.getElementById('dayTitle');  
    const scheduleTable=document.getElementById('scheduleTable');  
    let timeCells=[],inputElems=[];  
    let isAnimating = false; // Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…ØªÙƒØ±Ø±

    const baseTimes=[  
      "Ø§Ù„ÙØ¬Ø±","07:00 - 12:00","12:00 - 13:30",  
      "13:30 - 16:30","16:30 - Ø§Ù„Ù…ØºØ±Ø¨","Ø§Ù„Ù…ØºØ±Ø¨ - Ø§Ù„Ø¹Ø´Ø§Ø¡"  
    ];  

    function createTable(){  
      scheduleBody.innerHTML="";  
      timeCells=[]; inputElems=[];  
      for(let i=0;i<6;i++){  
        const tr=document.createElement('tr');  
        const tdTime=document.createElement('td');  
        tdTime.textContent=baseTimes[i];  
        const tdTask=document.createElement('td');  
        const input=document.createElement('input');  
        input.type="text";  

        // Ù†Ù…Ù„Ø£ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¥Ù† ÙˆÙØ¬Ø¯Øª Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
        const saved=localStorage.getItem(`${days[currentDayIndex]}_task_${i}`);  
        if(saved) input.value=saved;  

        // Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù†Ø®Ø²Ù† Ø¨Ø§Ø³Ù… Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¸Ø§Ù‡Ø± Ø­Ø§Ù„ÙŠØ§Ù‹ (Ø§Ù„Ù…ØªØºÙŠÙ‘Ø± currentDayIndex ÙŠØ­Ø¯Ù‘Ø« ÙÙŠ ÙˆÙ‚Øª Ø§Ù„ØªØ¨Ø¯ÙŠÙ„)
        input.addEventListener('input',()=>localStorage.setItem(`${days[currentDayIndex]}_task_${i}`,input.value));  

        tdTask.appendChild(input);  
        tr.appendChild(tdTime); tr.appendChild(tdTask);  
        scheduleBody.appendChild(tr);  
        timeCells.push(tdTime); inputElems.push(input);  
      }  
    }  

    // Ø¯Ø§Ù„Ø© ØªÙ‚ÙˆØ¯ ÙƒØ§Ù…Ù„ ØªØªØ§Ø¨Ø¹ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†: Ø®Ø±ÙˆØ¬ -> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -> Ø¯Ø®ÙˆÙ„
    function animateDayChange(dayIdx, direction = "right"){
      if(isAnimating) return; // Ø¥Ø°Ø§ Ù‡Ù†Ø§Ùƒ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø´ØºØ§Ù„ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©
      isAnimating = true;

      // 1) Ø¨Ø¯Ø¡ Ø­Ø±ÙƒØ© Ø§Ù„Ø®Ø±ÙˆØ¬: Ù†Ø²ÙŠÙ„ Ø­Ø§Ù„Ø© 'on' Ø«Ù… Ù†Ø¶ÙŠÙ off-(left|right)
      scheduleTable.classList.remove('on','off-left','off-right');
      // force reflow Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¥Ø²Ø§Ù„Ø© 'on' Ù…ÙØ³Ø¬Ù„Ø©
      void scheduleTable.offsetWidth;

      // Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
      if(direction === "left"){
        // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø³Ø­Ø¨ Ù„Ù„ÙŠØ³Ø§Ø± -> Ù†Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ: Ù†ÙØ®Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±
        scheduleTable.classList.add('off-left');
      } else {
        // Ø³Ø­Ø¨ Ù„Ù„ÙŠÙ…ÙŠÙ† -> Ù†Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚: Ù†Ø®Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†
        scheduleTable.classList.add('off-right');
      }

      // 2) Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†ØªÙ‡ÙŠ "Ø§Ù„Ø®Ø±ÙˆØ¬" (transitionend) Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø«Ù… Ù†ÙØ¯Ø®Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¬Ø¯ÙŠØ¯
      const onExit = (e) => {
        // Ù†Ø­Ø±Øµ Ø£Ù† Ø§Ù„Ø­Ø¯Ø« Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù†ÙØ³Ù‡
        if(e.target !== scheduleTable) return;

        scheduleTable.removeEventListener('transitionend', onExit);

        // Ø­Ø¯Ù‘Ø« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ (Ø¨Ø¹Ø¯ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…)
        dayTitle.textContent = `Ø§Ù„ÙŠÙˆÙ…: ${days[dayIdx]}`;
        inputElems.forEach((inp,i)=>{
          const saved = localStorage.getItem(`${days[dayIdx]}_task_${i}`);
          inp.value = saved || "";
        });

        // Ø¬Ù‡Ù‘Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø§Ù„Ù†Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø§ØªØ¬Ø§Ù‡
        scheduleTable.classList.remove('off-left','off-right');
        // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙƒÙˆÙ† Ù…Ù† Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©: Ø¥Ø°Ø§ Ø¯Ø®Ù„Øª Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† -> Ù†Ø¶Ø¹ off-right (Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©)
        if(direction === "left"){
          scheduleTable.classList.add('off-right'); // ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø«Ù… ÙŠØ£ØªÙŠ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ³Ø·
        } else {
          scheduleTable.classList.add('off-left');  // ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±
        }

        // force reflow Ø«Ù… Ù†ÙØ¸Ù‡Ø±Ù‡ (ÙŠØ¹Ù…Ù„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø©)
        void scheduleTable.offsetWidth;

        // Ù†Ù†ØªØ¸Ø± Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù†Ø±ÙØ¹ isAnimating
        const onEnter = (ev) => {
          if(ev.target !== scheduleTable) return;
          scheduleTable.removeEventListener('transitionend', onEnter);
          isAnimating = false;
        };

        scheduleTable.addEventListener('transitionend', onEnter);
        scheduleTable.classList.add('on'); // ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø§Ù„ØªØ­Ø±Ùƒ Ø¥Ù„Ù‰ translateX(0) Ùˆ opacity:1
      };

      scheduleTable.addEventListener('transitionend', onExit);
    }

    // Ø¨ÙÙ†Ù‰ ÙØ±Ø¹ÙŠØ©: ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª â€” Ù‡Ø°Ù‡ ØªØ³ØªØ¯Ø¹ÙŠ animateDayChange Ø¨Ø­ÙŠØ« ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…
    function updateInputs(dayIdx, direction="right"){
      // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø°ÙŠ ÙŠÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø®Ø±ÙˆØ¬ -> ØªØ­Ø¯ÙŠØ« -> Ø¯Ø®ÙˆÙ„
      animateDayChange(dayIdx, direction);
    }

    async function fetchPrayerTimes(){  
      const url=`https://api.aladhan.com/v1/timingsByCity?city=El%20Kala&country=Algeria&method=3`;  
      try{  
        const res=await fetch(url);  
        const json=await res.json();  
        const t=json.data.timings;  

        let [mh,mm]=t.Maghrib.split(":").map(Number);  
        mm += 3;  
        if(mm >= 60){ mm -= 60; mh += 1; }  
        mh = (mh + 24) % 24;  
        const maghribAdj = `${String(mh).padStart(2,"0")}:${String(mm).padStart(2,"0")}`;  

        const times={  
          fajr: t.Fajr.slice(0,5),  
          maghrib: maghribAdj,  
          isha: t.Isha.slice(0,5)  
        };  

        localStorage.setItem("lastPrayerTimes", JSON.stringify(times));  
        return times;  
      }catch(e){  
        const saved = localStorage.getItem("lastPrayerTimes");  
        if(saved) return JSON.parse(saved);  
        return {fajr:"05:00", maghrib:"18:33", isha:"19:30"};  
      }  
    }  

    async function updatePrayerCells(){  
      try {
        const times = await fetchPrayerTimes();  
        if(timeCells.length >= 6){  
          const fajrCell = `${times.fajr} - 07:00`;  
          const asrToMaghrib = `16:30 - ${times.maghrib}`;  
          const maghribToIsha = `${times.maghrib} - ${times.isha}`;  

          timeCells[0].textContent = fajrCell;  
          timeCells[4].textContent = asrToMaghrib;  
          timeCells[5].textContent = maghribToIsha;  

          localStorage.setItem("lastRenderedPrayerCells", JSON.stringify({  
            fajrCell, asrToMaghrib, maghribToIsha  
          }));  
        }  
      } catch(e){  
        const savedCells = localStorage.getItem("lastRenderedPrayerCells");  
        if(savedCells){  
          const parsed = JSON.parse(savedCells);  
          if(timeCells.length >= 6){  
            timeCells[0].textContent = parsed.fajrCell;  
            timeCells[4].textContent = parsed.asrToMaghrib;  
            timeCells[5].textContent = parsed.maghribToIsha;  
          }  
        }  
      }  
    }  

    // Ø§Ù„Ø³Ø­Ø¨ ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± (Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£ÙŠØ§Ù…) â€” Ù†ØºÙŠØ± currentDayIndex Ù‚Ø¨Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ updateInputs
    let touchStartX = 0;  
    document.addEventListener("touchstart", e => { touchStartX = e.changedTouches[0].screenX; });  
    document.addEventListener("touchend", e => {  
      let touchEndX = e.changedTouches[0].screenX;  
      if(touchEndX - touchStartX > 50){  // Ø³Ø­Ø¨ Ù„Ù„ÙŠÙ…ÙŠÙ† -> Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚
        currentDayIndex = (currentDayIndex + 6) % 7;  
        updateInputs(currentDayIndex,"right");  
      }  
      else if(touchStartX - touchEndX > 50){ // Ø³Ø­Ø¨ Ù„Ù„ÙŠØ³Ø§Ø± -> Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
        currentDayIndex = (currentDayIndex + 1) % 7;  
        updateInputs(currentDayIndex,"left");  
      }  
    });  

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    createTable();  
    // Ø¶Ø¨Ø· Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ Ù„Ù„Ù‘ÙŠØ§ÙˆÙ… (Ø¨Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¯ÙˆÙ† Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø£ÙˆÙ„ÙŠ)
    dayTitle.textContent=`Ø§Ù„ÙŠÙˆÙ…: ${days[currentDayIndex]}`;
    updatePrayerCells();  

    // ØªØ³Ø¬ÙŠÙ„ Service Worker  
    if ("serviceWorker" in navigator) {  
      window.addEventListener("load", () => {  
        navigator.serviceWorker.register("./service-worker.js")  
          .then(reg => console.log("SW Ù…Ø³Ø¬Ù„:", reg.scope))  
          .catch(err => console.error("Ø®Ø·Ø£ SW:", err));  
      });  
    }  
  </script>  
</body>  
</html>